"use strict";angular.module("govhackFrontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/alex",{templateUrl:"views/alex.html",controller:"AlexCtrl"}).when("/max",{templateUrl:"views/max.html",controller:"MaxCtrl"}).when("/mojgan",{templateUrl:"views/mojgan.html",controller:"MojganCtrl"}).otherwise({template:"",controller:function(a){a({method:"GET",url:"/404.html"}).success(function(a){document.open(),document.write(a),document.close()})}})}]),angular.module("govhackFrontendApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("govhackFrontendApp").controller("MainCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").directive("jsMap",["data",function(a){return{templateUrl:"views/jsmap.html",restrict:"E",link:function(b){function c(a){return h[a]}function d(){d3.selectAll(".big").transition().attr("r",v+8+"px").transition().attr("r",v+"px");var a=(j.slider("getValue"),i.slider("getValue"));++a,i.slider("setValue",a%i.slider("getAttribute","max"))}function e(a){b.sites={},$.each(a,function(a,c){/^[0-9]{6}$/.test(a)&&(b.sites[a]=c)}),k.draw()}function f(a,b){var c=p.fromLatLngToDivPixel(new google.maps.LatLng(b.lat,b.long));$(a).attr("transform","translate("+(c.x-m.x)+", "+(c.y-m.y)+")")}function g(){var a=new google.maps.Map(document.getElementById("map"),{center:t,zoom:4,mapTypeId:google.maps.MapTypeId.TERRAIN,disableDefaultUI:!0,styles:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{hue:"#EEDD33"},{lightness:-40},{saturation:-30}]},{featureType:"water",elementType:"all",stylers:[{visibility:"simplified"},{hue:"#ffffff"},{lightness:100},{saturation:100}]}]});k=new google.maps.OverlayView,k.onAdd=function(){var a=d3.select(this.getPanes().overlayLayer).append("svg");k.draw=function(){p=this.getProjection(),m=p.fromLatLngToDivPixel(s),n=p.fromLatLngToDivPixel(u),o=p.fromLatLngToDivPixel(t),v=(n.x-m.x)/160,a.style("left",m.x+"px").style("top",m.y+"px").style("width",n.x-m.x+"px").style("height",n.y-m.y+"px"),a.selectAll("g").data(d3.keys(b.sites)).enter().append("g").each(function(){d3.select(this).append("circle").attr("class","big"),d3.select(this).append("circle").attr("class","small")}).data(d3.keys(b.sites)).exit().remove(),a.selectAll("circle").attr("r",v).attr("cx",0).attr("cy",0).attr("fill","#ff0000"),a.selectAll("g").on("mouseover",function(){l!=this?(l=this,$("#map-info").css("left",q+10+"px").css("top",r+"px").show()):$("#map-info").show()}).on("mouseout",function(){l==this&&(l=this,$("#map-info").hide())}),a.selectAll("g").each(function(a){f(this,b.sites[a])})}},k.setMap(a),setInterval(d,1e3)}var h=["January","February","March","April","May","June","July","August","September","October","November","December"],i=$("#year-slider").slider({tooltip:"always"}),j=$("#month-slider").slider({tooltip:"always",formater:c});b.sites={};var k,l,m,n,o,p,q=0,r=0,s=new google.maps.LatLng(-5,110),t=new google.maps.LatLng(-28,133),u=new google.maps.LatLng(-49,156),v=0;$(document).bind("mousemove",function(a){q=a.pageX,r=a.pageY}),g(),a.getSites({dataset:"acorn-sat"}).$promise.then(e)}}}]),angular.module("govhackFrontendApp").controller("AlexCtrl",["$scope","data",function(){}]),angular.module("govhackFrontendApp").controller("MaxCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").controller("MojganCtrl",["$scope",function(a){a.test="Test",a.testSubmit=function(){a.test=a.testInput}}]),angular.module("govhackFrontendApp").factory("data",["$resource",function(a){var b="http://api.rubygovhackers.org/v1",c=a(b+"/sites/:dataset",{},{get:{method:"GET",cache:!0}}),d=a(b+"/timeseries/:timeperiod/:dataset",{},{get:{method:"GET",cache:!0}});return{getSites:function(a){return c.get(a)},getTimeseries:function(a){return d.query(a)}}}]),angular.module("govhackFrontendApp").directive("timeseries",["data",function(a){return{templateUrl:"views/timeseries.html",restrict:"E",link:function(b,c,d){var e=a.getTimeseries({timeperiod:"monthly",dataset:"acorn-sat",site:d.siteid,"max-temp":!0});e.$promise.then(function(){var a=new Rickshaw.Color.Palette,b=[{name:"Actual Max",data:[{x:-1893456e3,y:25868573},{x:-1577923200,y:29662053},{x:-1262304e3,y:34427091},{x:-946771200,y:35976777},{x:-631152e3,y:39477986},{x:-315619200,y:44677819},{x:0,y:49040703},{x:315532800,y:49135283},{x:631152e3,y:50809229},{x:946684800,y:53594378},{x:1262304e3,y:55317240}],color:a.color()},{name:"10 Years Average",data:[{x:-1893456e3,y:29888542},{x:-1577923200,y:34019792},{x:-1262304e3,y:38594100},{x:-946771200,y:40143332},{x:-631152e3,y:44460762},{x:-315619200,y:51619139},{x:0,y:56571663},{x:315532800,y:58865670},{x:631152e3,y:59668632},{x:946684800,y:64392776},{x:1262304e3,y:66927001}],color:a.color()},{name:"10 Years Highest Max",data:[{x:-1893456e3,y:29389330},{x:-1577923200,y:33125803},{x:-1262304e3,y:37857633},{x:-946771200,y:41665901},{x:-631152e3,y:47197088},{x:-315619200,y:54973113},{x:0,y:62795367},{x:315532800,y:75372362},{x:631152e3,y:85445930},{x:946684800,y:100236820},{x:1262304e3,y:114555744}],color:a.color()},{name:"10 Years Lowest Max",data:[{x:-1893456e3,y:7082086},{x:-1577923200,y:9213920},{x:-1262304e3,y:12323836},{x:-946771200,y:14379119},{x:-631152e3,y:20189962},{x:-315619200,y:28053104},{x:0,y:34804193},{x:315532800,y:43172490},{x:631152e3,y:52786082},{x:946684800,y:63197932},{x:1262304e3,y:71945553}],color:a.color()}],d=new Rickshaw.Graph({element:c[0],width:540,height:240,renderer:"line",series:b}),e=(new Rickshaw.Graph.Axis.Time({graph:d}),new Rickshaw.Graph.Axis.Y({graph:d,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.getElementById("y_axis")}),new Rickshaw.Graph.Legend({element:document.querySelector("#legend"),graph:d}),document.getElementById("offset_form"));e.addEventListener("change",function(a){var b=a.target.value;"lines"===b?(d.setRenderer("line"),d.offset="zero"):(d.setRenderer("stack"),d.offset=b),d.render()},!1),d.render()})}}}]),angular.module("govhackFrontendApp").directive("jsTimeseries",["data",function(a){var b=function(a,b){var c=d3.time.format(a).parse(b).getTime();return Math.round(c/1e3)};return{templateUrl:"views/jstimeseries.html",restrict:"E",link:function(){a.getTimeseries({timeperiod:"monthly",dataset:"acorn-sat",site:"001019","max-temp":!0}).$promise.then(function(a){for(var c=null,d=null,e=[],f=0;f<a.length;f++){var g=a[f].high_max_temp;(null===c||c>g)&&(c=g),(null===d||g>d)&&(d=g),e.push({x:b("%m-%Y",a[f].month),y:g})}var h=d3.scale.linear().domain([c,d]).nice(),i=new Rickshaw.Color.Palette,j=new Rickshaw.Graph({element:document.getElementById("chart"),width:780,height:250,renderer:"line",series:[{name:"Max Temp",data:e,color:i.color(),scale:h}]});new Rickshaw.Graph.Axis.Time({graph:j}),new Rickshaw.Graph.Axis.Y.Scaled({element:document.getElementById("y_axis"),graph:j,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,scale:h}),new Rickshaw.Graph.HoverDetail({graph:j}),j.render()})}}}]);