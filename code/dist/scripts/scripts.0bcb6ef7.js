"use strict";angular.module("govhackFrontendApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/alex",{templateUrl:"views/alex.html",controller:"AlexCtrl"}).when("/max",{templateUrl:"views/max.html",controller:"MaxCtrl"}).when("/mojgan",{templateUrl:"views/mojgan.html",controller:"MojganCtrl"}).when("/team-members",{templateUrl:"views/team-members.html",controller:"TeamMembersCtrl"}).otherwise({template:"",controller:function(a){a({method:"GET",url:"/404.html"}).success(function(a){document.open(),document.write(a),document.close()})}})}]),angular.module("govhackFrontendApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("govhackFrontendApp").controller("MainCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").directive("jsMap",["data",function(a){return{templateUrl:"views/jsmap.html",restrict:"E",link:function(b){function c(a){return j[a]}function d(){k&&(l=C.slader("getValue"),m=B.slader("getValue"),++m,B.slader("setValue",m%B.slader("getAttribute","max")),$("#display-date-month").text(j[l]),$("#display-date-year").text(m),e())}function e(){p.selectAll("g").each(function(a){g(this,b.sites[a])})}function f(a){b.sites=a.data,b.sites["023090"].data={},$.extend(b.sites["023090"].data,{200501:{month:"01-2005",high_max_temp:41.8},200502:{month:"02-2005",high_max_temp:42.8},200503:{month:"03-2005",high_max_temp:33.8},200504:{month:"04-2005",high_max_temp:34.8},200505:{month:"05-2005",high_max_temp:35.8},200506:{month:"06-2005",high_max_temp:36.8},200507:{month:"07-2005",high_max_temp:37.7},200508:{month:"08-2005",high_max_temp:48.8},200509:{month:"09-2005",high_max_temp:49.9},200510:{month:"10-2005",high_max_temp:41},200511:{month:"11-2005",high_max_temp:41.1},200512:{month:"12-2005",high_max_temp:21.2},200601:{month:"01-2006",high_max_temp:21.1},200602:{month:"02-2006",high_max_temp:21.2},200603:{month:"03-2006",high_max_temp:21.3},200604:{month:"04-2006",high_max_temp:21.4},200605:{month:"05-2006",high_max_temp:21.5},200606:{month:"06-2006",high_max_temp:11.6},200607:{month:"07-2006",high_max_temp:11.7},200608:{month:"08-2006",high_max_temp:41.8}}),o.draw()}function g(a,b){var c=u.fromLatLngToDivPixel(new google.maps.LatLng(b.lat,b.long));$(a).attr("transform","translate("+(c.x-r.x)+", "+(c.y-r.y)+")"),a!==q&&("undefined"!=typeof b.data&&"undefined"!=typeof b.data[100*m+l]?d3.select(a).select(".small").transition().style("fill","#ffaa00").attr("r",A+A*b.data[100*m+l].high_max_temp/n[1]):d3.select(a).select(".small").transition().style("fill","").style("opacity","").attr("r",A))}function h(a){$("#map-info").html('<div class="info-label">'+a.label+'</div><div class="info-text"><div class="row"><div class="col-lg-5">Latitude:</div><div class="col-lg-7">'+a.lat+'</div><div class="col-lg-5">Longitude:</div><div class="col-lg-7">'+a.long+"</div></div></div>")}function i(){var a=new google.maps.Map(document.getElementById("map"),{center:y,zoom:4,disableDefaultUI:!0,styles:[{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"},{color:"#FFFFFF"}]},{featureType:"landscape",stylers:[{saturation:-60},{lightness:-60},{gamma:0},{hue:"#ff0000"}]}]});o=new google.maps.OverlayView,o.onAdd=function(){p=d3.select(this.getPanes().overlayLayer).append("svg"),o.draw=function(){u=this.getProjection(),r=u.fromLatLngToDivPixel(x),s=u.fromLatLngToDivPixel(z),t=u.fromLatLngToDivPixel(y),A=(s.x-r.x)/800+4,p.style("left",r.x+"px").style("top",r.y+"px").style("width",s.x-r.x+"px").style("height",s.y-r.y+"px"),p.selectAll("g").data(d3.keys(b.sites)).enter().append("g").each(function(){d3.select(this).append("circle").attr("class","big"),d3.select(this).append("circle").attr("class","small")}).data(d3.keys(b.sites)).exit().remove(),p.selectAll("circle").attr("r",A).attr("cx",0).attr("cy",0).attr("fill","#ff0000"),p.selectAll("g").select(".small").on("mousemove",function(){q!==this.parentNode&&(q=this.parentNode,h(b.sites[this.__data__])),d3.select(this).style("fill","#ffffff").style("opacity","1").attr("r",2*A),$("#map-info").css("left",v+10+"px").css("top",w-60+"px").slideDown(50)}).on("mouseout",function(){q=null,g(this.parentNode,b.sites[this.__data__]),$("#map-info").slideUp(50)}),e()}},o.setMap(a),setInterval(d,1e3)}var j=["January","February","March","April","May","June","July","August","September","October","November","December"],k=!1,l=0,m=0,n=[-10,60];b.sites={};var o,p,q,r,s,t,u,v=0,w=0,x=new google.maps.LatLng(-5,110),y=new google.maps.LatLng(-28,133),z=new google.maps.LatLng(-49,156),A=0;$(document).bind("mousemove",function(a){v=a.pageX,w=a.pageY}),$("#button-play").click(function(){k=!k,$(this).find("span").toggleClass("glyphicon-play").toggleClass("glyphicon-pause")});var B=$("#year-slader").slader({tooltip:"always"}),C=$("#month-slader").slader({tooltip:"always",formater:c});i(),a.getSites({dataset:"acorn-sat"}).$promise.then(f)}}}]),angular.module("govhackFrontendApp").controller("AlexCtrl",["$scope","data",function(a,b){a.site="059040",a.sites=b.getSites({dataset:"acorn-sat"})}]),angular.module("govhackFrontendApp").controller("MaxCtrl",["$scope",function(){}]),angular.module("govhackFrontendApp").controller("MojganCtrl",["$scope",function(a){a.test="Test",a.testSubmit=function(){a.test=a.testInput}}]),angular.module("govhackFrontendApp").factory("data",["$resource",function(a){var b="http://api.rubygovhackers.org/v1",c=function(a){var b=JSON.parse(a);return{data:b}},d=a(b+"/sites/:dataset",{},{get:{method:"GET",cache:!0,transformResponse:c}}),e=a(b+"/timeseries/:timeperiod/:dataset",{},{get:{method:"GET",cache:!0,transformResponse:c}});return{getSites:function(a){return d.get(a)},getTimeseries:function(a){return e.get(a)}}}]),angular.module("govhackFrontendApp").directive("timeseries",["data",function(a){return{templateUrl:"views/timeseries.html",restrict:"E",link:function(b,c,d){var e=a.getTimeseries({timeperiod:"monthly",dataset:"acorn-sat",site:d.siteid,"max-temp":!0});e.$promise.then(function(){var a=new Rickshaw.Color.Palette,b=[{name:"Actual Max",data:[{x:-1893456e3,y:25868573},{x:-1577923200,y:29662053},{x:-1262304e3,y:34427091},{x:-946771200,y:35976777},{x:-631152e3,y:39477986},{x:-315619200,y:44677819},{x:0,y:49040703},{x:315532800,y:49135283},{x:631152e3,y:50809229},{x:946684800,y:53594378},{x:1262304e3,y:55317240}],color:a.color()},{name:"10 Years Average",data:[{x:-1893456e3,y:29888542},{x:-1577923200,y:34019792},{x:-1262304e3,y:38594100},{x:-946771200,y:40143332},{x:-631152e3,y:44460762},{x:-315619200,y:51619139},{x:0,y:56571663},{x:315532800,y:58865670},{x:631152e3,y:59668632},{x:946684800,y:64392776},{x:1262304e3,y:66927001}],color:a.color()},{name:"10 Years Highest Max",data:[{x:-1893456e3,y:29389330},{x:-1577923200,y:33125803},{x:-1262304e3,y:37857633},{x:-946771200,y:41665901},{x:-631152e3,y:47197088},{x:-315619200,y:54973113},{x:0,y:62795367},{x:315532800,y:75372362},{x:631152e3,y:85445930},{x:946684800,y:100236820},{x:1262304e3,y:114555744}],color:a.color()},{name:"10 Years Lowest Max",data:[{x:-1893456e3,y:7082086},{x:-1577923200,y:9213920},{x:-1262304e3,y:12323836},{x:-946771200,y:14379119},{x:-631152e3,y:20189962},{x:-315619200,y:28053104},{x:0,y:34804193},{x:315532800,y:43172490},{x:631152e3,y:52786082},{x:946684800,y:63197932},{x:1262304e3,y:71945553}],color:a.color()}],d=new Rickshaw.Graph({element:c[0],width:540,height:240,renderer:"line",series:b}),e=(new Rickshaw.Graph.Axis.Time({graph:d}),new Rickshaw.Graph.Axis.Y({graph:d,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.getElementById("y_axis")}),new Rickshaw.Graph.Legend({element:document.querySelector("#legend"),graph:d}),document.getElementById("offset_form"));e.addEventListener("change",function(a){var b=a.target.value;"lines"===b?(d.setRenderer("line"),d.offset="zero"):(d.setRenderer("stack"),d.offset=b),d.render()},!1),d.render()})}}}]),angular.module("govhackFrontendApp").directive("jsTimeseries",["data",function(a){return{templateUrl:"views/jstimeseries.html",restrict:"E",link:function(b,c,d){var e=null,f=null,g=new Rickshaw.Color.Palette,h=null,i={name:"Max Temp",data:[],color:g.color()},j={name:"Min Temp",data:[],color:g.color()},k=function(a){i.data.length=0;for(var b in a.data){var c=a.data[b],d=moment(b,"YYYYMM");if(0===d.month()){var e=c.high_max_temp;if(angular.isUndefined(e)||null===e)continue;i.data.push({x:d.unix(),y:e})}}j.data.length=0;for(var b in a.data){var c=a.data[b],d=moment(b,"YYYYMM");if(0===d.month()){var f=c.low_min_temp;if(angular.isUndefined(f)||null===f)continue;j.data.push({x:d.unix(),y:f})}}i.data.sort(function(a,b){return parseFloat(a.x)-parseFloat(b.x)}),j.data.sort(function(a,b){return parseFloat(a.x)-parseFloat(b.x)});var g=$.map(i.data.concat(j.data),function(a){return a.y});h=d3.scale.linear().domain([Math.min.apply(Math,g),Math.max.apply(Math,g)]).nice(),i.scale=h,j.scale=h};d.$observe("site",function(b){a.getTimeseries({timeperiod:"monthly",dataset:"acorn-sat",site:b,high_max_temp:!0,low_min_temp:!0}).$promise.then(function(a){k(a),null===e&&(e=new Rickshaw.Graph({element:c.find(".js-timeseries-chart").get(0),width:700,height:250,renderer:"line",series:[i,j]}),new Rickshaw.Graph.Axis.Time({graph:e}),f=new Rickshaw.Graph.Axis.Y.Scaled({element:c.find(".js-timeseries-y-axis").get(0),graph:e,orientation:"left",tickFormat:function(a){return Rickshaw.Fixtures.Number.formatKMBT(a)+"°C"},scale:h}),new Rickshaw.Graph.HoverDetail({graph:e,formatter:function(a,b,c){return a.name+": "+c.toFixed(1)+"°C"},xFormatter:function(a){return moment.unix(a).format("MMM YYYY")}}),new Rickshaw.Graph.RangeSlider({graph:e,element:c.find(".js-timeseries-preview").get(0)})),f.scale=h,e.render(),f.render()})})}}}]),angular.module("govhackFrontendApp").controller("TeamMembersCtrl",["$scope",function(){}]);